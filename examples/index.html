<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>Yaoyorozu Example</title>
    <script src="./dist/main.js"></script>

  </head>
  <body>
    <div><canvas id="main-canvas" ></canvas>
    </div> 
    <div><button type="button" onclick="videoStart()">撮影開始</button>　
    <button type="button" onclick="videoStop()">撮影停止</button></div>
    <p class="description"> Current Corner :<span id="pos"> </span> </p> 
  </body>
    <style type="text/css">
      .description {overflow:hidden;}
    </style>
    <script type="text/javascript">

      let canvas = document.getElementById("main-canvas");
      let context = canvas.getContext('2d');
      let cw = Math.min(window.innerWidth, 1000);
      let ch = Math.min(window.innerHeight, 1000);
      cw = Math.min(ch, cw);
      ch = Math.min(ch, cw);

      canvas.width = cw;
      canvas.height = ch;

      const resolution = {
        width: cw,
        height: ch,
      }
      let detecter = new yaoyorozu.Detect('./models/yaoyorozu_js.pb/model.json');
      let cap = new yaoyorozu.WebcamCapture(resolution.width, resolution.height);
      let text = document.getElementById("pos");
      cap.start();

      function loop(timestamp) {
        let image = cap.capture();
        context.putImageData(image, 0, 0, 0, 0, resolution.width, resolution.height);
        let result = detecter.detect(image);
        if (result) {
          for (let i1=0; i1<4; i1++) {

            let i2 = (i1+1) % 4;
            let c1 = result[i1];
            let c2 = result[i2]
            context.lineWidth = 5;
            context.beginPath();
            context.moveTo(...c1);
            context.lineTo(...c2);
            context.closePath();
            context.stroke();
          }
        }
        window.requestAnimationFrame(ts => loop(ts));
        text.innerText = result;
      }
      window.requestAnimationFrame(ts => loop(ts));
    </script>
</html>